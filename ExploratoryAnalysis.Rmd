---
title: "Exploratory analysis of OP006 operant data"
author: "JeremyMetha"
date: "26/07/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(FactoMineR)
library(factoextra)
library(ggplot2)
library(corrplot)
library(ape)
library(caret)
library(RColorBrewer)
library(rmarkdown)
library(knitr)

arm1 <- read.csv("cleanarm1.csv")
```

## R Markdown


```{r cars}
head(arm1)


M1 <- arm1[arm1$Subject=='1.1' ,]
summary(M1)
table(M1$Choice)
table(M1$Reward)

M1L <- subset(arm1, Subject=='1.1' & Task=='0P005_WTL')
dim(M1L)
table(M1L$Choice)
summary(M1L)
D1 <- subset(arm1, Subject=='1.1' & Task=='0P005_WTL' & Day=='1')
T <- list(J1$Time)
T

M1R <- subset(arm1, Subject=='1.1' & Task=='0P005_WTR')
dim(M1R)
table(M1R$Choice)
```


# Sort out the Data and Create the Timeresponse column
```{r}

arm1 <- arm1 %>% 
  group_by(Day, Subject) %>% 
  arrange(Trial) %>% 
  mutate(Timebetween = (Time - lag(Time))*0.1) # Calculate the time between each presses (in seconds)



sortarm1 <- arrange(arm1, Subject, Day, Time) # Sort out the data 

head(sortarm1)


```

# Analysing Mouse 1.1

```{r}

d1M1 <- filter(sortarm1,Subject=='1.1')
head(d1M1)

qplot(Trial, Timebetween, data = d1M1, geom='line') +
  facet_wrap(~ Day) +
  labs(y = "Time needed between two presses (in seconds)",
       x = "Trial number",
       title = "Evolution of Timebetween Data for mouse 1.1 for the 10 days of experiment")
ggsave("Timeevolution1.1.png", width = 11, height = 8)


# Graphs showing the evolution of time between per trial for each day

ggplot(data = d1M1, aes(x = Trial, y = Timebetween)) +
  geom_boxplot() + 
  facet_grid(. ~ Day) +
  labs(y = "Time needed between two presses (in seconds)",
       x = "Trial number",
       title = "Evolution of Timebetween Data for mouse 1.1 for the 10 days of experiment") +
  theme_linedraw() +
  theme(strip.text = element_text(size = rel(1)),
        panel.grid = element_blank())

ggsave("TimebetweenMouse1.1.png", width = 11, height = 8)

```

```{r}
#head(arm1)

#sortarm1 %>% 
#  group_by(Day) %>% 
#  mutate(mean_timeb = mean(Timebetween, na.rm = TRUE)) %>% 
#  select(Subject, Day, mean_timeb)

TBD <- sortarm1 %>%
  group_by(Day, Subject) %>%
  summarise(mean_timeb = mean(Timebetween, na.rm=TRUE)) # New frame with the mean of timebetween for each day and each mouse. 

```


```{r}

qplot(Day, mean_timeb, data = TBD) +
  facet_wrap(~ Subject) +
  labs(y = "Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween Data per days for each mouse")

```
```{r}

```

# Mouse 1

Mouse 1.1 is a smart one. (Cf.Learning-Analysis)
On TPGS treatment.
The maximum number of trials is around 1000 (10 times 100 presses). He pressed 979 on 1000 trials. 
Among these 979 presses, 808 were the high rewarded lever and only 171 on the low lever. 
During the reversal phase (WTR), mouse 1.1 pressed 100 times the lever each 5 days. 
We can see that during the WTL session, he pressed 435/479 (90,8%) the high lever and 44/479 (9,2%) the low lever while during the reversal phase (WTR), he pressed 373/500 (74,6%) the high lever and 127/500 (25,4%) the low lever. 
The probability of success is obviously much better before the reversal. 


Other remarks : 

