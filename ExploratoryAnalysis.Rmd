---
title: "Exploratory analysis of OP006 operant data"
author: "JeremyMetha & MathildeBertheau"
date: "26/07/2019"
output: 
  html_document:
    
    
    df_print: paged
    toc: true
    toc_depth: 2
    number_sections: true
    theme: yeti
    fig_width: 7
    fig_height: 6
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(FactoMineR)
library(factoextra)
library(ggplot2)
library(corrplot)
library(ape)
library(caret)
library(RColorBrewer)
library(rmarkdown)
library(knitr)
library(gridExtra)
library(cowplot)


arm1 <- read.csv("cleanarm1.csv")
```

## R Markdown


```{r cars}
head(arm1)


M1 <- arm1[arm1$Subject=='1.1' ,]
summary(M1)
table(M1$Choice)
table(M1$Reward)

M1L <- subset(arm1, Subject=='1.1' & Task=='0P005_WTL')
dim(M1L)
table(M1L$Choice)
summary(M1L)
D1 <- subset(arm1, Subject=='1.1' & Task=='0P005_WTL' & Day=='1')


M1R <- subset(arm1, Subject=='1.1' & Task=='0P005_WTR')
dim(M1R)
table(M1R$Choice)
```


# Sort out the Data and Create the Timeresponse column
```{r}

arm1 <- arm1 %>% 
  group_by(Day, Subject) %>% 
  arrange(Trial) %>% 
  mutate(Timebetween = (Time - lag(Time))*0.1) # Calculate the time between each presses (in seconds)



sortarm1 <- arrange(arm1, Subject, Day, Time) # Sort out the data 

head(sortarm1)


```

# Analysing Mouse 1.1

```{r}

d1M1 <- filter(sortarm1,Subject=='1.1')
head(d1M1)

qplot(Trial, Timebetween, data = d1M1, geom='line') +
  facet_wrap(~ Day) +
  labs(y = "Time needed between two presses (in seconds)",
       x = "Trial number",
       title = "Evolution of Timebetween (Trials) Data for mouse 1.1 for the 10 days of experiment")
ggsave("Timeevolution1.1.png", width = 11, height = 8)


# Graphs showing the evolution of time between per trial for each day

ggplot(data = d1M1, aes(x = Trial, y = Timebetween)) +
  geom_boxplot() + 
  facet_grid(. ~ Day) +
  labs(y = "Time needed between two presses (in seconds)",
       x = "Trial number",
       title = "Evolution of Timebetween (Trials) Data for mouse 1.1 for the 10 days of experiment") +
  theme_linedraw() +
  theme(strip.text = element_text(size = rel(1)),
        panel.grid = element_blank())

ggsave("TimebetweenMouse1.1.png", width = 11, height = 8)

```

```{r}
#head(arm1)

#sortarm1 %>% 
#  group_by(Day) %>% 
#  mutate(mean_timeb = mean(Timebetween, na.rm = TRUE)) %>% 
#  select(Subject, Day, mean_timeb)

TBD <- sortarm1 %>%
  group_by(Day, Subject) %>%
  summarise(mean_timeb = mean(Timebetween, na.rm=TRUE)) # New frame with the mean of timebetween for each day and each mouse. 
```


```{r}

M1 <- filter(TBD, Subject=='1.1')
ggplot(M1) + geom_point(aes(x = Day, y = mean_timeb))
gM1 <- ggplot(M1) + geom_line(aes(x = Day, y = mean_timeb)) + 
  labs(y = "Mean of Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween (mean) Data for mouse 1.1 for the 10 days of experiment")
gM1
ggsave("EvolutionofTimebetweenMouse1.1.png", width = 11, height = 8)

```

# Mouse 1

Mouse 1.1 is a smart one. (Cf.Learning-Analysis)
On TPGS treatment.
The maximum number of trials is around 1000 (10 times 100 presses). He pressed 979 on 1000 trials. 
Among these 979 presses, 808 were the high rewarded lever and only 171 on the low lever. 
During the reversal phase (WTR), mouse 1.1 pressed 100 times the lever each 5 days. 
We can see that during the WTL session, he pressed 435/479 (90,8%) the high lever and 44/479 (9,2%) the low lever while during the reversal phase (WTR), he pressed 373/500 (74,6%) the high lever and 127/500 (25,4%) the low lever. 
The probability of success is obviously much better before the reversal. 


Graphs : 

The time of response decrease from day 2 to 5. (from 10,3s to 8s). We can see an increase of the time of response on day 6, which is the first day of reversal. Then the time of response decrease again to 8,25s. 



#Mouse 2
```{r}
M2 <- filter(TBD, Subject=='1.2')
ggplot(M2) + geom_point(aes(x = Day, y = mean_timeb))
gM2 <- ggplot(M2) + geom_line(aes(x = Day, y = mean_timeb)) + 
  labs(y = "Mean of Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween (mean) Data for mouse 1.2 for the 10 days of experiment")
gM2
ggsave("EvolutionofTimebetweenMouse1.2.png", width = 11, height = 8)
```

#Mouse 3
```{r}
M3 <- filter(TBD, Subject=='2.3')
ggplot(M3) + geom_point(aes(x = Day, y = mean_timeb))
gM3 <- ggplot(M3) + geom_line(aes(x = Day, y = mean_timeb)) + 
  labs(y = "Mean of Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween (mean) Data for mouse 2.3 for the 10 days of experiment")
gM3
ggsave("EvolutionofTimebetweenMouse2.3.png", width = 11, height = 8)
```

#Mouse 4 
```{r}
M4 <- filter(TBD, Subject=='2.4')
ggplot(M4) + geom_point(aes(x = Day, y = mean_timeb))
gM4 <- ggplot(M4) + geom_line(aes(x = Day, y = mean_timeb)) + 
  labs(y = "Mean of Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween (mean) Data for mouse 2.4 for the 10 days of experiment")
gM4
ggsave("EvolutionofTimebetweenMouse2.4.png", width = 11, height = 8)
```

# Group of graph : Mice 1.1, 1.2, 2.3 and 2.4

```{r}
#plot_grid(gM1,gM2,gM3,gM4, labels=c("M1.1", "M1.2","M2.3", "M2.4"), ncol = 2, nrow = 2) 


```

# Analysing the timebetween per day and per mouse

```{r}
ggplot(TBD) + geom_point(aes(x = Day, y = mean_timeb, color = Subject))
```



```{r}

qplot(Day, mean_timeb, data = TBD) +
  facet_wrap(~ Subject) +
  labs(y = "Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween Data per days for each mouse")

```



# Separation of the two groups 

# TPGS Analyse time of response
```{r}


TBD2 <- sortarm1 %>% 
  group_by(Day, Subject) %>%
  mutate(mean_timeb = mean(Timebetween, na.rm = TRUE)) 
  

TPGS <- filter(TBD2, Treatment=='T')


TPGS2 <- TPGS %>% # New frame : mean of time of response for each day in the TPGS group
  group_by(Day) %>% 
  mutate(mean_day = mean(mean_timeb, na.rm = TRUE)) %>% 
  select(mean_day, Day) %>%
  distinct

TPGS2

ggplot(TPGS2) + geom_point(aes(x = Day, y = mean_day)) +
  labs(y = "Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween Data for the TPGS group - MEAN per DAY")

ggsave("EvolutionofTimeResponse_MEAN-per-DAY_TPGS.png", width = 11, height = 8)


ggplot(TPGS) + geom_point(aes(x = Day, y = mean_timeb)) +
  labs(y = "Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween Data for the TPGS group")
ggsave("EvolutionofTimeResponse_TPGS-1.png", width = 11, height = 8)


qplot(Day, mean_timeb, data = TPGS) +
  facet_wrap(~ Subject) +
  labs(y = "Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween Data for the TPGS group")

qplot(Day, mean_timeb, data = TPGS, color=Subject, geom='path') +  
  labs(y = "Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween Data for the TPGS group")
ggsave("EvolutionofTimeResponseTPGS-2.png", width = 11, height = 8)


```




# 1-SORA-51 Analyse time of response

```{r}
DRUG <- filter(TBD2, Treatment=='S')

DRUG2 <- DRUG %>% # New frame : mean of time of response for each day in the TPGS group
  group_by(Day) %>% 
  mutate(mean_day = mean(mean_timeb, na.rm = TRUE)) %>% 
  select(mean_day, Day) %>%
  distinct

DRUG2
summary(DRUG2$mean_day)


ggplot(DRUG2) + geom_point(aes(x = Day, y = mean_day)) +
    labs(y = "Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween Data for the DRUG group  - MEAN for each DAY")

ggsave("EvolutionofTimeResponse-MEAN-per-DAY_SORA.png", width = 11, height = 8)


ggplot(DRUG) + geom_point(aes(x = Day, y = mean_timeb)) +
  labs(y = "Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween Data for the DRUG group")

ggsave("EvolutionofTimeResponse-SORA-1.png", width = 11, height = 8)

qplot(Day, mean_timeb, data = DRUG) +
  facet_wrap(~ Subject) +
  labs(y = "Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween Data for the DRUG group")


qplot(Day, mean_timeb, data = DRUG, color=Subject, geom='path') +  
  labs(y = "Time needed between two presses (in seconds)",
       x = "Day",
       title = "Evolution of Timebetween Data for the DRUG group")
ggsave("EvolutionofTimeResponseSORA-2.png", width = 11, height = 8)



```



# Correction of the Data : Removing aberant subjects values.

## In TPGS group 

```{r}

```



Other remarks : 

